{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/dcat/extra/upload.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","w","$","Uploader","opts","extend","wrapper","addFileButton","isImage","preview","server","updateServer","deleteUrl","deleteData","thumbHeight","disabled","autoUpdateColumn","disableRemove","dimensions","lang","exceed_size","interrupt","upload_failed","selected_files","selected_has_failed","selected_success","dot","failed_num","pause_upload","go_on_upload","start_upload","upload_success_message","go_on_add","Q_TYPE_DENIED","Q_EXCEED_NUM_LIMIT","F_EXCEED_SIZE","Q_EXCEED_SIZE_LIMIT","F_DUPLICATE","upload","formData","_id","thumb","width","height","quality","allowMagnify","crop","preserveHeaders","type","$selector","selector","updateColumn","upload_column","Math","floor","random","elementName","$wrap","$queue","$statusBar","$info","$upload","$placeHolder","$progress","uploader","data","support","Dcat","showImg","originalFilesNum","helpers","len","$input","find","getFileViewSelector","fileId","replace","getFileView","addFileButtonSelector","faildFiles","formFiles","fileCount","fileSize","state","percentages","isSupportBase64","Image","onload","onerror","this","src","flashVersion","version","navigator","plugins","description","ex","ActiveXObject","GetVariable","ex2","match","parseFloat","file","Translator","__","trans","addFile","$li","$btns","size","WebUploader","formatSize","id","ext","toUpperCase","appendTo","nam","showError","code","text","setTimeout","css","margin","getStatus","statusText","image","makeThumb","error","img","empty","show","append","once","_info","info","_meta","meta","isset","validateDimensions","removeFile","resize","e","rotation","on","cur","prev","hide","remove","removeClass","addClass","post","serverId","_column","loading","result","status","deleteInput","message","previewImage","attr","removeUploadFile","updateTotalProgress","off","end","percent","loaded","total","$bar","each","k","v","round","updateStatusText","stats","showSuccess","getStats","successNum","num","success","uploadFailNum","fail","html","setState","val","args","removeAttr","refreshButton","location","reload","fileLimit","option","removeFormFile","fake","getInput","split","addInput","push","setInput","arr","filter","self","indexOf","join","refresh","appendUploadedFileForm","serverPath","serverUrl","deleteFile","click","url","options","build","browser","ie","container","window","swf","supportIe","items","denied","length","fileNumLimit","addButton","label","onUploadProgress","percentage","onBeforeFileQueued","onFileQueued","onFileDequeued","obj","reason","values","form","merge","serverName","path","onError","warning","hasClass","stop","retry","pop","addFileView","removeUploadFileView","getColumn","jQuery"],"mappings":"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","file":"/resources/dist/dcat/extra/upload.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n","(function (w, $) {\r\n    function Uploader(opts) {\r\n        opts = $.extend({\r\n            wrapper: '.web-uploader', // 图片显示容器选择器\r\n            addFileButton: '.add-file-button', // 继续添加按钮选择器\r\n            isImage: false,\r\n            preview: [], // 数据预览\r\n            server: '',\r\n            updateServer: '',\r\n            deleteUrl: '',\r\n            deleteData: {},\r\n            thumbHeight: 160,\r\n            disabled: false, // 禁止任何上传编辑\r\n            autoUpdateColumn: false,\r\n            disableRemove: false, // 禁止删除图片，允许替换\r\n            dimensions: {\r\n                // width: 100, // 图片宽限制\r\n                // height: 100, // 图片高限制\r\n                // min_width: 100, //\r\n                // min_height: 100,\r\n                // max_width: 100,\r\n                // max_height: 100,\r\n                // ratio: 3/2, // 宽高比\r\n            },\r\n            lang: {\r\n                exceed_size: '文件大小超出',\r\n                interrupt: '上传暂停',\r\n                upload_failed: '上传失败，请重试',\r\n                selected_files: '选中:num个文件，共:size。',\r\n                selected_has_failed: '已成功上传:success个文件，:fail个文件上传失败，<a class=\"retry\"  href=\"javascript:\"\";\">重新上传</a>失败文件或<a class=\"ignore\" href=\"javascript:\"\";\">忽略</a>',\r\n                selected_success: '共:num个(:size)，已上传:success个。',\r\n                dot: '，',\r\n                failed_num: '失败:fail个。',\r\n                pause_upload: '暂停上传',\r\n                go_on_upload: '继续上传',\r\n                start_upload: '开始上传',\r\n                upload_success_message: '已成功上传:success个文件',\r\n                go_on_add: '继续添加',\r\n                Q_TYPE_DENIED: '对不起，不允许上传此类型文件',\r\n                Q_EXCEED_NUM_LIMIT: '对不起，已超出文件上传数量限制，最多只能上传:num个文件',\r\n                F_EXCEED_SIZE: '对不起，当前选择的文件过大',\r\n                Q_EXCEED_SIZE_LIMIT: '对不起，已超出文件大小限制',\r\n                F_DUPLICATE: '文件重复',\r\n\r\n            },\r\n            upload: { // web-uploader配置\r\n                formData: {\r\n                    _id: null, // 唯一id\r\n                },\r\n                thumb: {\r\n                    width: 160,\r\n                    height: 160,\r\n                    quality: 70,\r\n                    allowMagnify: true,\r\n                    crop: true,\r\n                    preserveHeaders: false,\r\n                    // 为空的话则保留原有图片格式。\r\n                    // 否则强制转换成指定的类型。\r\n                    // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\r\n                    // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\r\n                    type: 'image/jpeg'\r\n                },\r\n            }\r\n        }, opts);\r\n\r\n        var $selector = $(opts.selector),\r\n            updateColumn = opts.upload.formData.upload_column || ('webup' + Math.floor(Math.random()*10000)),\r\n            elementName = opts.elementName;\r\n\r\n        if (typeof opts.upload.formData._id == \"undefined\" || !opts.upload.formData._id) {\r\n            opts.upload.formData._id = updateColumn + Math.floor(Math.random()*10000);\r\n        }\r\n\r\n        let Dcat = w.Dcat,\r\n\r\n            $wrap,\r\n\r\n            // 展示图片\r\n            showImg = opts.isImage,\r\n\r\n            // 图片容器\r\n            $queue,\r\n\r\n            // 状态栏，包括进度和控制按钮\r\n            $statusBar,\r\n\r\n            // 文件总体选择信息。\r\n            $info,\r\n\r\n            // 上传按钮\r\n            $upload,\r\n\r\n            // 没选择文件之前的内容。\r\n            $placeHolder,\r\n\r\n            $progress,\r\n\r\n            // 已上传文件数量\r\n            originalFilesNum = Dcat.helpers.len(opts.preview),\r\n\r\n            // 上传表单\r\n            $input = $selector.find('input[name=\"' + elementName + '\"]'),\r\n\r\n            // 获取文件视图选择器\r\n            getFileViewSelector = function (fileId) {\r\n                return elementName.replace(/[\\[\\]]*/g, '_')+'-'+fileId;\r\n            },\r\n\r\n            getFileView = function (fileId) {\r\n                return $('#' + getFileViewSelector(fileId));\r\n            },\r\n\r\n            // 继续添加按钮选择器\r\n            addFileButtonSelector = opts.addFileButton,\r\n\r\n            // 临时存储上传失败的文件，key为file id\r\n            faildFiles = {},\r\n\r\n            // 临时存储添加到form表单的文件\r\n            formFiles = {},\r\n\r\n            // 添加的文件数量\r\n            fileCount = 0,\r\n\r\n            // 添加的文件总大小\r\n            fileSize = 0,\r\n\r\n            // 可能有pedding, ready, uploading, confirm, done.\r\n            state = 'pedding',\r\n\r\n            // 所有文件的进度信息，key为file id\r\n            percentages = {},\r\n            // 判断浏览器是否支持图片的base64\r\n            isSupportBase64 = (function () {\r\n                var data = new Image();\r\n                var support = true;\r\n                data.onload = data.onerror = function () {\r\n                    if (this.width != 1 || this.height != 1) {\r\n                        support = false;\r\n                    }\r\n                };\r\n                data.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n                return support;\r\n            })(),\r\n\r\n            // 检测是否已经安装flash，检测flash的版本\r\n            flashVersion = (function () {\r\n                var version;\r\n\r\n                try {\r\n                    version = navigator.plugins['Shockwave Flash'];\r\n                    version = version.description;\r\n                } catch (ex) {\r\n                    try {\r\n                        version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\r\n                            .GetVariable('$version');\r\n                    } catch (ex2) {\r\n                        version = '0.0';\r\n                    }\r\n                }\r\n                version = version.match(/\\d+/g);\r\n                return parseFloat(version[0] + '.' + version[1], 10);\r\n            })(),\r\n\r\n            // 判断是否是图片\r\n            isImage = function (file) {\r\n                return file.type.match(/^image/);\r\n            },\r\n\r\n            // 翻译\r\n            lang = Dcat.Translator(opts.lang),\r\n            __ = lang.trans.bind(lang),\r\n\r\n            // WebUploader实例\r\n            uploader;\r\n\r\n        // 当有文件添加进来时执行，负责view的创建\r\n        function addFile(file) {\r\n            var size = WebUploader.formatSize(file.size), $li, $btns;\r\n\r\n            if (showImg) {\r\n                $li = $(`<li id=\"${getFileViewSelector(file.id)}\" title=\"${file.name}\" >\r\n                    <p class=\"file-type\">${(file.ext.toUpperCase() || 'FILE')}</p>\r\n                    <p class=\"imgWrap \"></p>\r\n                    <p class=\"title\" style=\"\">${file.name}</p>\r\n                    <p class=\"title\" style=\"margin-bottom:20px;\">(<b>${size}</b>)</p>\r\n                    </li>`);\r\n\r\n                $btns = $(`<div class=\"file-panel\">\r\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"cancel\"><i class=\"fa fa-close red-dark\" style=\"font-size:13px\"></i></a>\r\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"delete\" style=\"display: none\">\r\n                    <i class=\"feather icon-trash red-dark\" style=\"font-size:13px\"></i></a>\r\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"preview\" ><i class=\"feather icon-zoom-in\"></i></a>\r\n                    </div>`).appendTo($li);\r\n            } else {\r\n                $li = $(`\r\n                    <li id=\"${getFileViewSelector(file.id)}\" title=\"${file.nam}\">\r\n                    <p class=\"title\" style=\"display:block\">\r\n                        <i class=\"feather icon-check green _success icon-success\"></i>\r\n                        ${file.name} (${size})\r\n                    </p>\r\n                    </li>\r\n                `);\r\n\r\n                $btns = $(`\r\n<span data-file-act=\"cancel\" class=\"file-action\" style=\"font-size:13px\">\r\n    <i class=\"feather icon-x red-dark\"></i>\r\n</span>\r\n<span data-file-act=\"delete\" class=\"file-action\" style=\"display:none\">\r\n    <i class=\"feather icon-trash red-dark\"></i>\r\n</span>\r\n`).appendTo($li);\r\n            }\r\n\r\n            var $wrap = $li.find('p.imgWrap'),\r\n                $info = $('<p class=\"error\"></p>'),\r\n\r\n                showError = function (code, file) {\r\n                    var text = '';\r\n                    switch (code) {\r\n                        case 'exceed_size':\r\n                            text = __('exceed_size');\r\n                            break;\r\n\r\n                        case 'interrupt':\r\n                            text = __('interrupt');\r\n                            break;\r\n\r\n                        default:\r\n                            text = __('upload_failed');\r\n                            break;\r\n                    }\r\n\r\n                    faildFiles[file.id] = file;\r\n\r\n                    $info.text(text).appendTo($li);\r\n                };\r\n\r\n            $li.appendTo($queue);\r\n\r\n            setTimeout(function () {\r\n                $li.css({margin: '5px'});\r\n            }, 50);\r\n\r\n            if (file.getStatus() === 'invalid') {\r\n                showError(file.statusText, file);\r\n            } else {\r\n                if (showImg) {\r\n                    var image = uploader.makeThumb(file, function (error, src) {\r\n                        var img;\r\n\r\n                        $wrap.empty();\r\n                        if (error) {\r\n                            $li.find('.title').show();\r\n                            $li.find('.file-type').show();\r\n                            return;\r\n                        }\r\n\r\n                        if (isSupportBase64) {\r\n                            img = $('<img src=\"' + src + '\">');\r\n                            $wrap.append(img);\r\n                        } else {\r\n                            $li.find('.file-type').show();\r\n                        }\r\n                    });\r\n\r\n                    try {\r\n                        image.once('load', function () {\r\n                            file._info = file._info || image.info();\r\n                            file._meta = file._meta || image.meta();\r\n                            var width = file._info.width,\r\n                                height = file._info.height;\r\n\r\n                            if (!validateDimensions(file)) {\r\n                                Dcat.error('The image dimensions is invalid.');\r\n                                uploader.removeFile(file);\r\n                                return false;\r\n                            }\r\n\r\n                            image.resize(width, height);\r\n                        });\r\n                    } catch (e) {\r\n                        // 不是图片\r\n                        return setTimeout(function () {\r\n                            uploader.removeFile(file);\r\n                        }, 10);\r\n                    }\r\n                }\r\n\r\n                percentages[file.id] = [file.size, 0];\r\n                file.rotation = 0;\r\n            }\r\n\r\n            file.on('statuschange', function (cur, prev) {\r\n                if (prev === 'progress') {\r\n                    // $prgress.hide().width(0);\r\n                } else if (prev === 'queued') {\r\n                    $btns.find('[data-file-act=\"cancel\"]').hide();\r\n                    $btns.find('[data-file-act=\"delete\"]').show();\r\n                }\r\n\r\n                // 成功\r\n                if (cur === 'error' || cur === 'invalid') {\r\n                    showError(file.statusText, file);\r\n                    percentages[file.id][1] = 1;\r\n                } else if (cur === 'interrupt') {\r\n                    showError('interrupt', file);\r\n                } else if (cur === 'queued') {\r\n                    percentages[file.id][1] = 0;\r\n                } else if (cur === 'progress') {\r\n                    $info.remove();\r\n                    // $prgress.css('display', 'block');\r\n                } else if (cur === 'complete') {\r\n                    if (showImg) {\r\n                        $li.append('<span class=\"success\"><em></em><i class=\"feather icon-check\"></i></span>');\r\n                    } else {\r\n                        $li.find('._success').show();\r\n                    }\r\n                }\r\n\r\n                $li.removeClass('state-' + prev).addClass('state-' + cur);\r\n            });\r\n\r\n            var $act = showImg ? $btns.find('a') : $btns;\r\n\r\n            $act.on('click', function () {\r\n                var index = $(this).data('file-act');\r\n\r\n                switch (index) {\r\n                    case 'cancel':\r\n                        uploader.removeFile(file);\r\n                        return;\r\n                    case 'deleteurl':\r\n                    case 'delete':\r\n                        if (opts.disableRemove) {\r\n                            return uploader.removeFile(file);\r\n                        }\r\n\r\n                        var post = opts.deleteData;\r\n\r\n                        post.key = file.serverId;\r\n                        if (!post.key) {\r\n                            return uploader.removeFile(file);\r\n                        }\r\n                        post._column = updateColumn;\r\n\r\n                        Dcat.loading();\r\n                        $.post(opts.deleteUrl, post, function (result) {\r\n                            Dcat.loading(false);\r\n                            if (result.status) {\r\n                                deleteInput(file.serverId);\r\n                                uploader.removeFile(file);\r\n                                return;\r\n                            }\r\n\r\n                            Dcat.error(result.message || 'Remove file failed.');\r\n                        });\r\n\r\n                        break;\r\n                    case 'preview':\r\n                        Dcat.helpers.previewImage($wrap.find('img').attr('src'), null, file.name);\r\n                        break;\r\n                }\r\n\r\n            });\r\n        }\r\n\r\n        // 图片宽高验证\r\n        function validateDimensions(file) {\r\n            // The image dimensions is invalid.\r\n            if (!showImg || !isImage(file) || !Dcat.helpers.len(opts.dimensions)) return true;\r\n            var dimensions = opts.dimensions,\r\n                width = file._info.width,\r\n                height = file._info.height,\r\n                isset = Dcat.helpers.isset;\r\n            if (\r\n                (isset(dimensions, 'width') && dimensions['width'] != width) ||\r\n                (isset(dimensions, 'min_width') && dimensions['min_width'] > width)||\r\n                (isset(dimensions, 'max_width') && dimensions['max_width'] < width) ||\r\n                (isset(dimensions, 'height') && dimensions['height'] != height) ||\r\n                (isset(dimensions, 'min_height') && dimensions['min_height'] > height) ||\r\n                (isset(dimensions, 'max_height') && dimensions['max_height'] < height) ||\r\n                (isset(dimensions, 'ratio') && dimensions['ratio'] != (width / height))\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        // 负责view的销毁\r\n        function removeUploadFile(file) {\r\n            var $li = getFileView(file.id);\r\n\r\n            delete percentages[file.id];\r\n            updateTotalProgress();\r\n            $li.off().find('.file-panel').off().end().remove();\r\n        }\r\n\r\n        function updateTotalProgress() {\r\n            var loaded = 0,\r\n                total = 0,\r\n                $bar = $progress.find('.progress-bar'),\r\n                percent;\r\n\r\n            $.each(percentages, function (k, v) {\r\n                total += v[0];\r\n                loaded += v[0] * v[1];\r\n            });\r\n\r\n            percent = total ? loaded / total : 0;\r\n            percent = Math.round(percent * 100) + '%';\r\n\r\n            $bar.text(percent);\r\n            $bar.css('width', percent);\r\n            updateStatusText();\r\n        }\r\n\r\n        function updateStatusText() {\r\n            var text = '', stats;\r\n\r\n            if (!uploader) {\r\n                return;\r\n            }\r\n\r\n            if (state === 'ready') {\r\n                stats = uploader.getStats();\r\n                if (fileCount) {\r\n                    text = __('selected_files', {num: fileCount, size: WebUploader.formatSize(fileSize)});\r\n                } else {\r\n                    showSuccess();\r\n                }\r\n            } else if (state === 'confirm') {\r\n                stats = uploader.getStats();\r\n                if (stats.uploadFailNum) {\r\n                    text = __('selected_has_failed', {success: stats.successNum, fail: stats.uploadFailNum});\r\n                }\r\n            } else {\r\n                showSuccess();\r\n            }\r\n\r\n            function showSuccess() {\r\n                stats = uploader.getStats();\r\n                if (stats.successNum) {\r\n                    text = __('selected_success', {num: fileCount, size: WebUploader.formatSize(fileSize), success: stats.successNum});\r\n                }\r\n\r\n                if (stats.uploadFailNum) {\r\n                    text += (text ? __('dot') : '') + __('failed_num', {fail: stats.uploadFailNum});\r\n                }\r\n            }\r\n\r\n            $info.html(text);\r\n        }\r\n\r\n        // 上传文件后修改字段值\r\n        function updateFileColumn() {\r\n            var values = getInput(),\r\n                num = uploader.getStats().successNum,\r\n                form = $.extend({}, opts.formData);\r\n\r\n            if (!num || !values || !opts.autoUpdateColumn) {\r\n                return;\r\n            }\r\n\r\n            form[updateColumn] = values.join(',');\r\n            delete form['upload_column'];\r\n\r\n            $.post(opts.updateServer, form);\r\n        }\r\n\r\n        function setState(val, args) {\r\n            var stats;\r\n            args = args || {};\r\n\r\n            if (val === state) {\r\n                return;\r\n            }\r\n\r\n            if ($upload) {\r\n                $upload.removeClass('state-' + state);\r\n                $upload.addClass('state-' + val);\r\n            }\r\n            state = val;\r\n\r\n            switch (state) {\r\n                case 'pedding':\r\n                    if (opts.disabled) return;\r\n                    $placeHolder.removeClass('element-invisible');\r\n                    $queue.hide();\r\n                    $statusBar.addClass('element-invisible');\r\n                    if (showImg) {\r\n                        $wrap.removeAttr('style');\r\n                        $wrap.find('.queueList').removeAttr('style');\r\n                    }\r\n\r\n                    refreshButton();\r\n                    break;\r\n\r\n                case 'ready':\r\n                    $placeHolder.addClass('element-invisible');\r\n                    $selector.find(addFileButtonSelector).removeClass('element-invisible');\r\n                    $queue.show();\r\n                    if (!opts.disabled) {\r\n                        $statusBar.removeClass('element-invisible');\r\n                    }\r\n                    refreshButton();\r\n                    if (showImg) {\r\n                        $wrap.find('.queueList').css({'border': '1px solid #d3dde5', 'padding':'5px'});\r\n                        // $wrap.find('.queueList').removeAttr('style');\r\n                    }\r\n                    break;\r\n\r\n                case 'uploading':\r\n                    $selector.find(addFileButtonSelector).addClass('element-invisible');\r\n                    $progress.show();\r\n                    $upload.text(__('pause_upload'));\r\n                    break;\r\n\r\n                case 'paused':\r\n                    $progress.show();\r\n                    $upload.text(__('go_on_upload'));\r\n                    break;\r\n\r\n                case 'confirm':\r\n                    if (uploader) {\r\n                        $progress.hide();\r\n                        $selector.find(addFileButtonSelector).removeClass('element-invisible');\r\n                        $upload.text(__('start_upload'));\r\n\r\n                        stats = uploader.getStats();\r\n                        if (stats.successNum && !stats.uploadFailNum) {\r\n                            setState('finish');\r\n                            return;\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'finish':\r\n                    if (uploader) {\r\n                        stats = uploader.getStats();\r\n                        if (stats.successNum) {\r\n                            Dcat.success(__('upload_success_message', {success: stats.successNum}));\r\n                        } else {\r\n                            // 没有成功的图片，重设\r\n                            state = 'done';\r\n                            location.reload();\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'decrOriginalFileNum':\r\n                    if (originalFilesNum > 0) originalFilesNum --;\r\n                    break;\r\n\r\n                case 'incrOriginalFileNum':\r\n                    originalFilesNum ++;\r\n                    break;\r\n\r\n                case 'decrFileNumLimit': // 减少上传文件数量限制\r\n                    if (!uploader) {\r\n                        return;\r\n                    }\r\n                    var fileLimit = uploader.option('fileNumLimit'),\r\n                        num = args.num || 1;\r\n\r\n                    if (fileLimit == '-1') fileLimit = 0;\r\n\r\n                    num = fileLimit >= num ? fileLimit - num : 0;\r\n\r\n                    if (num == 0) num = '-1';\r\n\r\n                    uploader.option('fileNumLimit', num);\r\n\r\n                    break;\r\n                case 'incrFileNumLimit': // 增加上传文件数量限制\r\n                    if (!uploader) {\r\n                        return;\r\n                    }\r\n                    var fileLimit = uploader.option('fileNumLimit'),\r\n                        num = args.num || 1;\r\n\r\n                    if (fileLimit == '-1') fileLimit = 0;\r\n\r\n                    num = fileLimit + num;\r\n\r\n                    uploader.option('fileNumLimit', num);\r\n                    break;\r\n                case 'init': // 初始化\r\n                    $upload.addClass('state-' + state);\r\n                    updateTotalProgress();\r\n\r\n                    if (originalFilesNum || opts.disabled) {\r\n                        $placeHolder.addClass('element-invisible');\r\n                        if (!opts.disabled) {\r\n                            $statusBar.show();\r\n                        } else {\r\n                            $wrap.addClass('disabled');\r\n                        }\r\n                        setState('ready');\r\n                    } else if (showImg) {\r\n                        $wrap.removeAttr('style');\r\n                        $wrap.find('.queueList').css('margin', '0');\r\n                    }\r\n                    refreshButton();\r\n                    break;\r\n\r\n            }\r\n\r\n            updateStatusText();\r\n        }\r\n\r\n        // 移除form表单的文件\r\n        function removeFormFile(fileId) {\r\n            if (!fileId) return;\r\n\r\n            var file = formFiles[fileId];\r\n\r\n            deleteInput(fileId);\r\n            delete formFiles[fileId];\r\n            if (uploader && !file.fake) {\r\n                uploader.removeFile(file);\r\n            }\r\n\r\n            setState('decrOriginalFileNum');\r\n            setState('incrFileNumLimit');\r\n\r\n            if (!Dcat.helpers.len(formFiles) && !Dcat.helpers.len(percentages)) {\r\n                setState('pedding');\r\n            }\r\n        }\r\n\r\n        // 获取表单值\r\n        function getInput() {\r\n            var val = $input.val();\r\n\r\n            return val ? val.split(',') : [];\r\n        }\r\n\r\n        // 新增表单值\r\n        function addInput(id) {\r\n            var val = getInput();\r\n            val.push(id);\r\n            setInput(val);\r\n        }\r\n\r\n        // 设置表单值\r\n        function setInput(arr) {\r\n            arr = arr.filter(function(v, k, self) {\r\n                return self.indexOf(v) === k;\r\n            }).filter(function (v) {\r\n                return v ? true : false;\r\n            });\r\n\r\n            $input.val(arr.join(','));\r\n        }\r\n\r\n        // 删除表单值\r\n        function deleteInput(id) {\r\n            if (!id) {\r\n                return $input.val('');\r\n            }\r\n            setInput(getInput().filter(function (v) {\r\n                return v != id;\r\n            }));\r\n        }\r\n\r\n        // 重新计算按钮定位\r\n        function refreshButton() {\r\n            uploader.refresh();\r\n        }\r\n\r\n        // 添加上传成功文件到表单区域\r\n        function appendUploadedFileForm(file) {\r\n            var html = \"\";\r\n            html += \"<li title='\" + file.serverPath + \"'>\";\r\n\r\n            if (showImg) {\r\n                html += `<p class='imgWrap'><img src='${file.serverUrl}'></p>`\r\n            } else if (! opts.disabled) {\r\n                html += `<p class=\"file-action\" data-file-act=\"delete\" data-id=\"${file.serverId}\"><i class=\"feather icon-trash red-dark\"></i></p>`;\r\n            }\r\n\r\n            html += \"<p class='title' style=''><i class='feather icon-check text-white icon-success text-white'></i>\";\r\n            html += file.serverPath;\r\n            html += \"</p>\";\r\n\r\n            if (showImg) {\r\n                html += \"<p class='title' style='margin-bottom:20px;'>&nbsp;</p>\";\r\n                html += \"<div class='file-panel' >\";\r\n\r\n                if (! opts.disabled) {\r\n                    html += `<a class='btn btn-sm btn-white' data-file-act='deleteurl' data-id='${file.serverId}'><i class='feather icon-trash red-dark' style='font-size:13px'></i></a>`;\r\n                }\r\n                html += `<a class='btn btn-sm btn-white' data-file-act='preview' data-url='${file.serverUrl}' ><i class='feather icon-zoom-in'></i></a>`;\r\n\r\n                html += \"</div>\";\r\n            }\r\n\r\n            html += \"</li>\";\r\n            html = $(html);\r\n\r\n            if (!showImg) {\r\n                html.find('.file-type').show();\r\n                html.find('.title').show();\r\n                $wrap.css('background', 'transparent');\r\n            }\r\n\r\n            var deleteFile = function () {\r\n                var fileId = $(this).data('id'), post = opts.deleteData;\r\n\r\n                if (opts.disableRemove) {\r\n                    html.remove();\r\n\r\n                    return removeFormFile(fileId);\r\n                }\r\n\r\n                post.key = fileId;\r\n                post._column = updateColumn;\r\n\r\n                Dcat.loading();\r\n                $.post(opts.deleteUrl, post, function (result) {\r\n                    Dcat.loading(false);\r\n                    if (result.status) {\r\n                        // 移除\r\n                        html.remove();\r\n\r\n                        removeFormFile(fileId);\r\n                        return;\r\n                    }\r\n\r\n                    Dcat.error(result.message || 'Remove file failed.')\r\n                });\r\n            };\r\n\r\n            // 删除按钮点击事件\r\n            html.find('[data-file-act=\"deleteurl\"]').click(deleteFile);\r\n            html.find('[data-file-act=\"delete\"]').click(deleteFile);\r\n\r\n\r\n            // 放大图片\r\n            html.find('[data-file-act=\"preview\"]').click(function () {\r\n                var url = $(this).data('url');\r\n\r\n                Dcat.helpers.previewImage(url);\r\n            });\r\n\r\n            setState('incrOriginalFileNum');\r\n            setState('decrFileNumLimit');\r\n            formFiles[file.serverId] = file;\r\n\r\n            addInput(file.serverId);\r\n\r\n            $queue.append(html);\r\n\r\n            if (showImg) {\r\n                setTimeout(function () { html.css('margin', '5px');}, 400);\r\n            }\r\n        }\r\n\r\n        // 初始化web-uploader\r\n        function build() {\r\n            $wrap = $selector.find(opts.wrapper);\r\n\r\n            // 图片容器\r\n            $queue = $('<ul class=\"filelist\"></ul>').appendTo($wrap.find('.queueList'));\r\n\r\n            // 状态栏，包括进度和控制按钮\r\n            $statusBar = $wrap.find('.statusBar');\r\n\r\n            // 文件总体选择信息。\r\n            $info = $statusBar.find('.info');\r\n\r\n            // 上传按钮\r\n            $upload = $wrap.find('.upload-btn');\r\n\r\n            // 没选择文件之前的内容。\r\n            $placeHolder = $wrap.find('.placeholder');\r\n\r\n            $progress = $statusBar.find('.upload-progress').hide();\r\n\r\n            // IE;\r\n            supportIe();\r\n\r\n            // 实例化\r\n            this.uploader = uploader = WebUploader.create(opts.upload);\r\n\r\n            // 拖拽时不接受 js, txt 文件。\r\n            uploader.on('dndAccept', function (items) {\r\n                var denied = false,\r\n                    len = items.length,\r\n                    i = 0,\r\n                    // 修改js类型\r\n                    unAllowed = 'text/plain;application/javascript ';\r\n\r\n                for (; i < len; i++) {\r\n                    // 如果在列表里面\r\n                    if (~unAllowed.indexOf(items[i].type)) {\r\n                        denied = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                return !denied;\r\n            });\r\n\r\n            if (opts.upload.fileNumLimit > 1 && !opts.disabled) {\r\n                // 添加“添加文件”的按钮，\r\n                uploader.addButton({\r\n                    id: addFileButtonSelector,\r\n                    label: '<i class=\"feather icon-folder\"></i> &nbsp;' + __('go_on_add')\r\n                });\r\n            }\r\n\r\n            uploader.onUploadProgress = function (file, percentage) {\r\n                percentages[file.id][1] = percentage;\r\n                updateTotalProgress();\r\n            };\r\n\r\n            uploader.onBeforeFileQueued = function (file) {\r\n\r\n            };\r\n\r\n            uploader.onFileQueued = function (file) {\r\n                fileCount++;\r\n                fileSize += file.size;\r\n\r\n                if (fileCount === 1) {\r\n                    $placeHolder.addClass('element-invisible');\r\n                    $statusBar.show();\r\n                }\r\n\r\n                addFile(file);\r\n                setState('ready');\r\n                updateTotalProgress();\r\n            };\r\n\r\n            // 删除文件事件监听\r\n            uploader.onFileDequeued = function (file) {\r\n                fileCount--;\r\n                fileSize -= file.size;\r\n\r\n                if (!fileCount && !Dcat.helpers.len(formFiles)) {\r\n                    setState('pedding');\r\n                }\r\n\r\n                removeUploadFile(file);\r\n            };\r\n\r\n            uploader.on('all', function (type, obj, reason) {\r\n                switch (type) {\r\n                    case 'uploadFinished':\r\n                        setState('confirm');\r\n                        updateFileColumn();\r\n                        break;\r\n\r\n                    case 'startUpload':\r\n                        setState('uploading');\r\n                        break;\r\n\r\n                    case 'stopUpload':\r\n                        setState('paused');\r\n                        break;\r\n                    case  'uploadAccept':\r\n                        // 上传失败，返回false\r\n                        if (reason && reason.error) {\r\n                            Dcat.error(reason.error.message);\r\n\r\n                            faildFiles[obj.file.id] = obj.file;\r\n\r\n                            return false;\r\n                        }\r\n\r\n                        if (reason.merge) {\r\n                            // 分片上传\r\n                            return;\r\n                        }\r\n\r\n                        // 上传成功，保存新文件名和路径到file对象\r\n                        obj.file.serverId   = reason.id;\r\n                        obj.file.serverName = reason.name;\r\n                        obj.file.serverPath = reason.path;\r\n                        obj.file.serverUrl  = reason.url || null;\r\n\r\n                        addInput(reason.id);\r\n\r\n                        if (!showImg) {\r\n                            var $li = getFileView(obj.file.id);\r\n                            $li.find('.file-action').hide();\r\n                            $li.find('[data-file-act=\"delete\"]').show();\r\n                        }\r\n\r\n                        break;\r\n                }\r\n\r\n            });\r\n\r\n            uploader.onError = function (code) {\r\n                switch (code) {\r\n                    case 'Q_TYPE_DENIED':\r\n                        Dcat.error(__('Q_TYPE_DENIED'));\r\n                        break;\r\n                    case 'Q_EXCEED_NUM_LIMIT':\r\n                        Dcat.error(__('Q_EXCEED_NUM_LIMIT', {num: opts.upload.fileNumLimit}));\r\n                        break;\r\n                    case 'F_EXCEED_SIZE':\r\n                        Dcat.error(__('F_EXCEED_SIZE'));\r\n                        break;\r\n                    case 'Q_EXCEED_SIZE_LIMIT':\r\n                        Dcat.error(__('Q_EXCEED_SIZE_LIMIT'));\r\n                        break;\r\n                    case 'F_DUPLICATE':\r\n                        Dcat.warning(__('F_DUPLICATE'));\r\n                        break;\r\n                    default:\r\n                        Dcat.error('Error: ' + code);\r\n                }\r\n\r\n            };\r\n\r\n            $upload.on('click', function () {\r\n                if ($(this).hasClass('disabled')) {\r\n                    return false;\r\n                }\r\n\r\n                if (state === 'ready') {\r\n                    uploader.upload();\r\n                } else if (state === 'paused') {\r\n                    uploader.upload();\r\n                } else if (state === 'uploading') {\r\n                    uploader.stop();\r\n                }\r\n            });\r\n\r\n            $info.on('click', '.retry', function () {\r\n                uploader.retry();\r\n            });\r\n\r\n            $info.on('click', '.ignore', function () {\r\n                for (var i in faildFiles) {\r\n                    uploader.removeFile(i, true);\r\n                    delete faildFiles[i];\r\n                }\r\n\r\n            });\r\n\r\n            setState('init');\r\n        }\r\n\r\n        // 预览\r\n        function preview() {\r\n            for (var i in opts.preview) {\r\n                var path = opts.preview[i].path, ext;\r\n\r\n                if (path.indexOf('.')) {\r\n                    ext = path.split('.').pop();\r\n                }\r\n\r\n                appendUploadedFileForm({\r\n                    serverId: opts.preview[i].id,\r\n                    serverUrl: opts.preview[i].url,\r\n                    serverPath: path,\r\n                    ext: ext,\r\n                    fake: 1,\r\n                })\r\n            }\r\n        }\r\n\r\n        this.uploader = uploader;\r\n        this.options = opts;\r\n        this.build = build;\r\n        this.preview = preview;\r\n        this.setState = setState;\r\n        this.refreshButton = refreshButton;\r\n        this.getFileView = getFileView;\r\n        this.getFileViewSelector = getFileViewSelector;\r\n        this.addFileView = addFile;\r\n        this.removeUploadFileView = removeUploadFile;\r\n        this.isImage = isImage;\r\n        this.getColumn = function () {\r\n            return updateColumn;\r\n        };\r\n\r\n        function supportIe() {\r\n            if (!WebUploader.Uploader.support('flash') && WebUploader.browser.ie) {\r\n\r\n                // flash 安装了但是版本过低。\r\n                if (flashVersion) {\r\n                    (function (container) {\r\n                        window['expressinstallcallback'] = function (state) {\r\n                            switch (state) {\r\n                                case 'Download.Cancelled':\r\n                                    break;\r\n\r\n                                case 'Download.Failed':\r\n                                    Dcat.error('Install failed!');\r\n                                    break;\r\n\r\n                                default:\r\n                                    Dcat.success('Install Success！');\r\n                                    break;\r\n                            }\r\n                            delete window['expressinstallcallback'];\r\n                        };\r\n\r\n                        var swf = './expressInstall.swf';\r\n                        // insert flash object\r\n                        var html = `<object type=\"application/x-shockwave-flash\" data=\"${swf}\" `;\r\n\r\n                        if (WebUploader.browser.ie) {\r\n                            html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\r\n                        }\r\n\r\n                        html += `width=\"100%\" height=\"100%\" style=\"outline:0\">\r\n                            <param name=\"movie\" value=\"${swf}\" />\r\n                            <param name=\"wmode\" value=\"transparent\" />\r\n                            <param name=\"allowscriptaccess\" value=\"always\" />\r\n                            </object>`;\r\n\r\n                        container.html(html);\r\n\r\n                    })($wrap);\r\n\r\n                } else {\r\n                    $wrap.html('<a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_blank\" border=\"0\"><img alt=\"get flash player\" src=\"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg\" /></a>');\r\n                }\r\n\r\n                return;\r\n            } else if (!WebUploader.Uploader.support()) {\r\n                Dcat.error('您的浏览器不支持Web Uploader！');\r\n                return;\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    Dcat.Uploader = function (options) {\r\n        return new Uploader(options)\r\n    };\r\n\r\n})(window, jQuery);"],"sourceRoot":""}